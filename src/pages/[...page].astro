---
import Default from "@/templates/Default.astro";
import StoriesPlayer from "@/components/interactive/StoriesPlayer.astro";
import type { GetStaticPaths, Page } from "astro";
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";

export const getStaticPaths = (async ({ paginate }) => {
    const allArticles = await getCollection("articles", (entry) => {
        return entry.data.draft !== true;
    });

    const sortedArticles = allArticles.sort(
        (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf(),
    );

    return paginate(sortedArticles, { pageSize: 2 });
}) satisfies GetStaticPaths;

type Props = {
    page: Page<CollectionEntry<"articles">>;
};

const { page } = Astro.props;
---

<Default
    title={page.currentPage === 1
        ? "Home"
        : `Articles - Page ${page.currentPage}`}
>
    <link rel="stylesheet" href="style.css" slot="icons" />
    <StoriesPlayer />
    <h1>Articles</h1>

    <ul>
        {
            page.data.map((article) => (
                <li>
                    <a href={`/articles/${article.id}`}>
                        <h2>{article.data.title}</h2>
                        <time datetime={article.data.publishDate.toISOString()}>
                            {article.data.publishDate.toLocaleDateString()}
                        </time>
                        {article.data.excerpt && <p>{article.data.excerpt}</p>}
                        {article.data.readingTime && (
                            <span>{article.data.readingTime}</span>
                        )}
                    </a>
                </li>
            ))
        }
    </ul>

    <nav aria-label="Pagination">
        {page.url.prev && <a href={page.url.prev}>← Previous</a>}
        <span>Page {page.currentPage} of {page.lastPage}</span>
        {page.url.next && <a href={page.url.next}>Next →</a>}
    </nav>
</Default>
