---
import Default from "@/templates/Default.astro";
import DefaultCard from "@/components/display/DefaultCard.astro";
import MetaTags from "@/components/structure/MetaTags.astro";
import Pagination from "@/components/navigation/Pagination.astro";
import type { GetStaticPaths, Page } from "astro";
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";

export const getStaticPaths = (async ({ paginate }) => {
    const allArticles = await getCollection("articles", (entry) => {
        return entry.data.draft !== true;
    });

    const sortedArticles = allArticles.sort(
        (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf(),
    );

    return paginate(sortedArticles, { pageSize: 9 });
}) satisfies GetStaticPaths;

type Props = {
    page: Page<CollectionEntry<"articles">>;
};

const { page } = Astro.props;
---

<Default title={`Diajar Artikel | Halaman ${page.currentPage}`}>
    <MetaTags
        slot="meta-tags"
        title={`Diajar Artikel | Halaman ${page.currentPage}`}
        author="Muhamad Deni Ramdan"
        description="Diajar adalah tempat belajar mandiri seputar web, desain, dan irisannya."
        url={`${Astro.site}${page.currentPage === 1 ? "" : page.currentPage}`}
    />
    <ul class="col-start-2 flex flex-col gap-4 px-4">
        {
            page.data.map((article) => (
                <li>
                    <DefaultCard article={article} />
                </li>
            ))
        }
    </ul>

    <Pagination
        currentPage={page.currentPage}
        lastPage={page.lastPage}
        urlPattern=""
        maxVisible={7}
        className="col-start-2"
    />
</Default>
